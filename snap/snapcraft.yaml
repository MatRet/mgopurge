name: mgopurge
version: git
summary: Cleanup Mongo databases managed by mgo/txn
description: |
    This runs several steps to handle known issues with mgo/txn. Specifically things like:
        * transaction ids referenced by documents but the transaction itself is missing.
        * transaction queues growing too long
        * being able to cleanup transactions that have been applied from the txns collection.


grade: devel
confinement: devmode

apps:
    mgopurge:
        command: mgopurge

parts:
    gb:
        plugin: go
        source: https://github.com/constabulary/gb.git
        go-importpath: github.com/constabulary/gb
        go-packages:
            - github.com/constabulary/gb
    mgopurge:
        after: [gb]
        source: .
        plugin: make
        artifacts:
            - bin/mgopurge
        override-build: |
            make snap-release
